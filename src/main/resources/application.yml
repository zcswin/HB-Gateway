server:
  port: ${APP_PORT:8080}

spring:
  application:
    name: api-gateway
  mvc:
    pathmatch:
      matching-strategy: ANT_PATH_MATCHER
  security:
    user:
      name: admin
      password: admin
      roles: ADMIN
  cloud:
    gateway:
      routes: 
        - id: swagger-ui
          uri: http://${spring.cloud.client.ip-address}:${server.port}
          predicates:
            - Path=/swagger-ui/**
          filters:
            - RewritePath=/swagger-ui/(?<path>.*), /$\{path}

        - id: api-docs
          uri: http://localhost:${server.port}
          predicates:
            - Path=/v3/api-docs/**
          filters:
            - RewritePath=/v3/api-docs/(?<path>.*), /v3/api-docs/$\{path}
               
        - id: provider-service # 路由ID，唯一标识
          uri: lb://service-provider # 路由目标服务，lb表示负载均衡
          predicates: # 路由断言，用于匹配请求
            - Path=/ui-provider/** # 匹配路径以/products/开头的请求
          filters: # 路由过滤器
            - AddRequestHeader=X-Request-Id, 123456 # 添加请求头
            - RewritePath=/ui-(?<service>[^/]+)/(?<segment>.*), /service-$\{service}/$\{segment}
        - id: consumer-service # 新增Consumer服务的路由
          uri: lb://service-consumer
          predicates:
            - Path=/ui-consumer/** # 匹配路径以/consumer/开头的请求
          filters:
            - AddRequestHeader=X-Consumer-Request-Id, 789012
            - RewritePath=/ui-(?<service>[^/]+)/(?<segment>.*), /service-$\{service}/$\{segment}

        - id: default-service-mapping # 默认路由
          uri: lb://HB-QMS-Provider # 默认服务
          predicates: # 路由断言，用于匹配请求
            - Path=/** # 匹配所有其他路径
                   
            
eureka:
  client:
    service-url:
      defaultZone: http://localhost:8761/eureka
    
management:
  endpoint:
    health:
      show-details: always
  endpoints:
    web:
      base-path: /actuator  #配置端点访问前缀
      exposure:
        include: health,info,env,metrics
  info: # 显示任意的应用信息，默认关闭  springBoot版本：2.7.5 CURRENT  GA如果是更低一些的版本默认是开启的
    env:
      enabled: true
      
springdoc:
  swagger-ui:
    enabled: true
    path: /swagger-ui/index.html
    operationsSorter: alpha
    tagsSorter: alpha
    tryItOutEnabled: true
  api-docs:
    enabled: true
    path: /v3/api-docs    

info:
  app:
    name: "@project.name@"
    encoding: "@project.build.sourceEncoding@"
    java:
      source: "@java.version@"
      target: "@java.version@"

#springdoc:
#  swagger-ui:
#    path: /swagger-ui

#logging:
#  level:
#    org.springframework.cloud.gateway: DEBUG
#    org.springdoc: DEBUG
